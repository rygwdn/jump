# jumpr zsh integration

# Hook to record directory visits (when PWD changes)
function __jumpr_visit() {
    \command {{exe_path}} update-frecency --visit -- "$PWD" 2>/dev/null
}

# Hook to update access time (when prompt is rendered)
function __jumpr_access() {
    \command {{exe_path}} update-frecency -- "$PWD" 2>/dev/null
}

# Initialize hooks
\builtin typeset -ga precmd_functions
\builtin typeset -ga chpwd_functions

# Remove any existing jumpr hooks
# shellcheck disable=SC2034,SC2296
precmd_functions=("${(@)precmd_functions:#__jumpr_access}")
# shellcheck disable=SC2034,SC2296
chpwd_functions=("${(@)chpwd_functions:#__jumpr_visit}")

# Add our hooks
precmd_functions+=(__jumpr_access)
chpwd_functions+=(__jumpr_visit)

# Navigation function
{{navigate_cmd}} () {
    local paths
    paths=($({{exe_path}} nav "$@"))
    if [[ ${#paths[@]} -gt 0 ]]; then
        cd ${paths[@]}
    fi
}

# Code function
{{code_cmd}} () {
    local paths
    paths=($({{exe_path}} nav --multi "$@"))
    if [[ ${#paths[@]} -gt 0 ]]; then
        code ${paths[@]}
    fi
}
